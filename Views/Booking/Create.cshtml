@model TripNest.Models.Booking

@{
    ViewData["Title"] = "Book Tour";
    var tour = ViewBag.Tour as TripNest.Models.Tour;
}

<div class="container mt-5">
    @if (tour == null)
    {
        <div class="alert alert-danger rounded-3">Tour information could not be loaded.</div>
    }
    else
    {
        <div class="card shadow-sm mb-5 mx-auto" style="max-width: 800px;">
            <div class="card-body">
                <h2 class="card-title mb-4" style="color: #27ae60;">Book Tour: @tour.Title</h2>

                <form asp-action="Create" method="post" class="mt-4">
                    <!-- Hidden TourId field -->
                    <input type="hidden" asp-for="TourId" value="@tour.Id" />

                    <!-- Row 1: Customer Name and Email -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label asp-for="CustomerName" class="form-label fw-bold"></label>
                            <input asp-for="CustomerName" class="form-control rounded-3" placeholder="Enter your full name" />
                            <span asp-validation-for="CustomerName" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Email" class="form-label fw-bold"></label>
                            <input asp-for="Email" class="form-control rounded-3" placeholder="Enter your email" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Row 2: Phone Number and Number of Guests -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label asp-for="PhoneNumber" class="form-label fw-bold"></label>
                            <input asp-for="PhoneNumber" class="form-control rounded-3" placeholder="Enter your phone number" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NumberOfGuests" class="form-label fw-bold"></label>
                            <input asp-for="NumberOfGuests" class="form-control rounded-3" type="number" min="1" max="100" placeholder="Number of guests" />
                            <span asp-validation-for="NumberOfGuests" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Preferred Tour Date -->
                    <div class="mb-4">
                        <label asp-for="PreferredTourDate" class="form-label fw-bold"></label>
                        <input asp-for="PreferredTourDate" class="form-control rounded-3" type="date" />
                        <span asp-validation-for="PreferredTourDate" class="text-danger"></span>
                    </div>

                    <!-- Special Requests -->
                    <div class="mb-4">
                        <label asp-for="SpecialRequests" class="form-label fw-bold"></label>
                        <textarea asp-for="SpecialRequests" class="form-control rounded-3" rows="3" placeholder="Any special requests?"></textarea>
                        <span asp-validation-for="SpecialRequests" class="text-danger"></span>
                    </div>

                    <!-- Additional Notes -->
                    <div class="mb-4">
                        <label asp-for="AdditionalNotes" class="form-label fw-bold"></label>
                        <textarea asp-for="AdditionalNotes" class="form-control rounded-3" rows="3" placeholder="Additional notes (optional)"></textarea>
                        <span asp-validation-for="AdditionalNotes" class="text-danger"></span>
                    </div>

                    <!-- Tour Price and Total Amount -->
                    <div class="mb-4 p-3 bg-light rounded-3">
                        <p class="mb-2"><strong>Tour Price per Guest:</strong> $@tour.Price</p>
                        <p class="mb-0"><strong>Total Amount:</strong> <span id="totalAmount">$@Model.TotalAmount</span></p>
                    </div>

                    <!-- Submit -->
                    <button type="submit" class="btn btn-custom btn-lg rounded-pill">Confirm Booking</button>
                </form>
            </div>
        </div>
    }
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const pricePerGuest = @tour.Price;
        const guestsInput = document.querySelector('input[name="NumberOfGuests"]');
        const totalAmountSpan = document.getElementById('totalAmount');

        function updateTotal() {
            let guests = parseInt(guestsInput.value) || 0;
            if (guests < 1) guests = 1;
            const total = (pricePerGuest * guests).toFixed(2);
            totalAmountSpan.textContent = `$${total}`;
        }

        guestsInput.addEventListener('input', updateTotal);
        updateTotal();
    </script>
}

<style>

    .body{
        background-color: #fff;
    }
    .card {
        border-radius: 10px;
        transition: transform 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
    }
    .form-control, .form-control:focus {
        border-color: #ced4da;
        box-shadow: none;
        transition: border-color 0.2s;
    }
    .form-control:focus {
        border-color: #27ae60;
    }
    .btn-custom {
        background-color: #27ae60;
        border-color: #27ae60;
        color: #faf8f5;
        border-radius: 0.5rem !important; 
        transition: background-color 0.3s ease, transform 0.3s ease;
    }
    .btn-custom:hover {
        background-color: #219653; 
        border-color: #219653;
        color: #faf8f5;
        transform: scale(1.05);
        text-decoration: none !important;
    }
</style>