@model TripNest.Models.ViewModels.ProfileDashboardViewModel

@{
    ViewData["Title"] = "My Profile";
}

<div class="container mt-4">
    <h2>@Model.Profile.FirstName @Model.Profile.LastName's Dashboard</h2>

    <!-- Profile Info Section -->
    <div class="row mt-4">
        <div class="col-md-4">
            <img src="@Model.Profile.ProfileImageUrl" alt="Profile Image" class="img-thumbnail"
                 style="width: 100%; max-width: 200px;" />
        </div>
        <div class="col-md-8">
            <ul class="list-group">
                <li class="list-group-item"><strong>Email:</strong> @Model.Profile.Email</li>
                <li class="list-group-item"><strong>Phone:</strong> @Model.Profile.PhoneNumber</li>
                <li class="list-group-item"><strong>Address:</strong> @Model.Profile.Address</li>
                <li class="list-group-item"><strong>Country:</strong> @Model.Profile.Country</li>
                <li class="list-group-item"><strong>Language:</strong> @Model.Profile.PreferredLanguage</li>
            </ul>
        </div>
    </div>

    <hr class="my-5" />

    <!-- Bookings Section -->
    <h3>Your Bookings</h3>

    @if (Model.Bookings != null && Model.Bookings.Any())
    {
        <table class="table table-bordered table-hover mt-3 align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Image</th>
                    <th>Tour</th>
                    <th>Booking Date</th>
                    <th>Guests</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var booking in Model.Bookings)
                {
                    <tr>
                        <td style="width: 100px;">
                            @* If TourImageUrl property exists in BookingViewModel, otherwise remove this *@
                            <img src="@booking.TourImageUrl" alt="@booking.TourName" class="img-thumbnail"
                                 style="max-width: 100px; height: auto;" />
                        </td>
                        <td>@booking.TourName</td>
                        <td>@booking.BookingDate.ToString("yyyy-MM-dd")</td>
                        <td>@booking.NumberOfGuests</td>  @* Make sure NumberOfGuests exists or remove *@
                        <td>
                            @switch (booking.Status.ToLower())
                            {
                                case "confirmed":
                                    <span class="badge bg-success">Confirmed</span>
                                    break;
                                case "pending":
                                    <span class="badge bg-warning text-dark">Pending</span>
                                    break;
                                case "completed":
                                    <span class="badge bg-primary">Completed</span>
                                    break;
                                case "cancelled":
                                    <span class="badge bg-danger">Cancelled</span>
                                    break;
                                default:
                                    <span class="badge bg-secondary">@booking.Status</span>
                                    break;
                            }
                        </td>
                        <td style="white-space: nowrap;">
                            <a asp-controller="Bookings" asp-action="Details" asp-route-id="@booking.Id"
                               class="btn btn-sm btn-info me-1">
                                View Details
                            </a>

                            <a href="mailto:@booking.AgencyContactEmail" class="btn btn-sm btn-primary me-1">
                                Contact Agency
                            </a>

                            @if (booking.Status.ToLower() == "completed")
                            {
                                <a asp-controller="Review" asp-action="Create" asp-route-bookingId="@booking.Id"
                                   class="btn btn-sm btn-success me-1">
                                    Leave a Review
                                </a>
                            }

                           
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="alert alert-info mt-3">
            You have no bookings yet.
        </div>
    }

    <hr class="my-5" />

    <!-- Reviews Section -->
    <h3>Your Reviews</h3>

    @if (Model.Reviews != null && Model.Reviews.Any())
    {
        <div class="list-group mt-3">
            @foreach (var review in Model.Reviews)
            {
                <div class="list-group-item">
                    <h5 class="mb-1">@review.TourTitle</h5>  @* corrected from @review.Tour.Title *@
                    <p class="mb-1">@review.Content</p>
                    <small>Rating: @review.Rating/5</small><br />
                    <small>Reviewed on: @review.CreatedAt.ToString("yyyy-MM-dd")</small>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info mt-3">
            You haven't submitted any reviews yet.
        </div>
    }
</div>
